b4w.register("runner",function(y,d){function z(g,a){a?A.load(B+"runner.json",C):console.log("b4w init failure")}function C(g,a){if(a){t.enable_controls();var b=e.get_active_camera();h=e.get_first_character();u.append_stiff_trans(b,h,[0,3.2,12]);D();E();var b=new Float32Array([0,-.3,0]),v=e.get_object_by_name("ArmatureSanta");p.stop(v);u.append_stiff(v,h,b);k("terr1");k("terr2");k("terr3");l=e.get_object_children(e.get_object_by_name("okruzhenie1"));for(b=l.length-1;0<=b;b--)k(l[b]);w()}else console.log("b4w load failure")}
function w(){var a=m.get_translation(h);if(Math.abs(a[2])>16*n){k("terr1");k("terr2");k("terr3");l=e.get_object_children(e.get_object_by_name("okruzhenie1"));for(a=l.length-1;0<=a;a--)k(l[a]);0==n%4&&F();n++}setTimeout(function(){w()},100)}function k(a){a="string"==typeof a?e.get_object_by_name(a):a;m.set_translation_obj_rel(a,0,0,-16,a)}function F(){var a;a=1+3*Math.random();a=Math.round(a);if(1==a)var c=e.get_object_by_name("prep1");else 2==a?c=e.get_object_by_name("stena1"):3==a?c=e.get_object_by_name("stena2"):
4==a&&(c=e.get_object_by_name("stena3"));var b=m.get_translation(h);b[2]-=48;b[1]=3.5;1<a&&(b[0]=3,b[1]=3.2);m.set_translation_v(c,b)}function E(){var g=a.create_collision_sensor(h,"PODAROK",!0),c=a.create_collision_sensor(h,"TERR_POL"),b=a.create_collision_sensor(h,"KONEC");a.create_sensor_manifold(h,"COLL_IN_PLAYER",a.CT_TRIGGER,[g],function(a){return a[0]},function(b,c,g,e){var f=a.get_sensor_payload(b,c,0);console.log({obj:b,id:c,pulse:g,param:e,collision_pt:f})},98);a.create_sensor_manifold(h,
"COLL2_IN_PLAYER",a.CT_TRIGGER,[c],function(a){return a[0]},function(a,b,c,g){q&&(console.log({obj:a,id:b,pulse:c,param:g}),a=e.get_object_by_name("ArmatureSanta"),1==c?p.play(a):p.stop(a))},98);a.create_sensor_manifold(h,"COLL3_IN_PLAYER",a.CT_TRIGGER,[b],function(a){return a[0]},function(a,b,c,g){1==c&&alert("HAPPY NEW YEAR !!!")},98)}function D(){var g={keyForward:!1,keyBackward:!1,triggerForwardBackward:0,keyLeft:!1,keyRight:!1,triggerLeftRight:0,setKeyForward:function(a){this.keyForward=a;this.triggerForwardBackward=
1},setKeyBackward:function(a){this.keyBackward=a;this.triggerForwardBackward=-1},setKeyLeft:function(a){this.keyLeft=a;this.triggerLeftRight=1},setKeyRight:function(a){this.keyRight=a;this.triggerLeftRight=-1},getForwardBackward:function(){if(this.keyForward&&!this.keyBackward&&1==this.triggerForwardBackward)return 1;if(this.keyForward&&this.keyBackward&&-1==this.triggerForwardBackward)return-1;if(this.keyForward&&!this.keyBackward&&-1==this.triggerForwardBackward)return 1;if(!this.keyForward&&this.keyBackward&&
-1==this.triggerForwardBackward)return-1;if(this.keyForward&&this.keyBackward&&1==this.triggerForwardBackward)return 1;if(!this.keyForward&&this.keyBackward&&1==this.triggerForwardBackward)return-1;if(!this.keyForward&&!this.keyBackward)return 0},getLeftRight:function(){if(this.keyLeft&&!this.keyRight&&1==this.triggerLeftRight)return-1;if(this.keyLeft&&this.keyRight&&-1==this.triggerLeftRight)return 1;if(this.keyLeft&&!this.keyRight&&-1==this.triggerLeftRight)return-1;if(!this.keyLeft&&this.keyRight&&
-1==this.triggerLeftRight)return 1;if(this.keyLeft&&this.keyRight&&1==this.triggerLeftRight)return-1;if(!this.keyLeft&&this.keyRight&&1==this.triggerLeftRight)return 1;if(!this.keyLeft&&!this.keyRight)return 0}},c=a.create_keyboard_sensor(a.KEY_A),b=a.create_keyboard_sensor(a.KEY_S),d=a.create_keyboard_sensor(a.KEY_D),h=a.create_keyboard_sensor(a.KEY_W),k=a.create_keyboard_sensor(a.KEY_SPACE),l=a.create_keyboard_sensor(a.KEY_SHIFT),m=0,n=0,c=[h,b,c,d,l],b=e.get_first_character();r.obj=b;d=function(a,
b,c){if(0==q){q=!0;var d=e.get_object_by_name("ArmatureSanta");p.play(d)}if(1==c)switch(b){case "LEFT":g.setKeyLeft(!0);break;case "RIGHT":g.setKeyRight(!0)}else switch(b){case "LEFT":g.setKeyLeft(!1);break;case "RIGHT":g.setKeyRight(!1)}n=-1;m=g.getLeftRight();1==c&&"RUNNING"==b?r.set(f.CM_RUN):1!=c&&"RUNNING"==b&&r.set(f.CM_WALK);f.set_character_move_dir(a,n,m)};a.create_sensor_manifold(b,"FORWARD",a.CT_TRIGGER,c,function(a){return a[0]},d);a.create_sensor_manifold(b,"BACKWARD",a.CT_TRIGGER,c,function(a){return a[1]},
d);a.create_sensor_manifold(b,"LEFT",a.CT_TRIGGER,c,function(a){return a[2]},d);a.create_sensor_manifold(b,"RIGHT",a.CT_TRIGGER,c,function(a){return a[3]},d);a.create_sensor_manifold(b,"RUNNING",a.CT_TRIGGER,c,function(a){return(a[0]||a[1]||a[2]||a[3])&&a[4]},d);a.create_sensor_manifold(b,"JUMP",a.CT_SHOT,[k],null,function(a,b,c){f.character_jump(a)})}var t=d("app"),G=d("config"),A=d("data"),H=d("version"),a=d("controls"),e=d("scenes"),f=d("physics"),u=d("constraints");d("objects");var m=d("transform"),
p=d("animation"),x="DEBUG"===H.type(),B=G.get_std_assets_path()+"runner/",h,n=1,l,q=!1;y.init=function(){t.init({canvas_container_id:"main_canvas_container",callback:z,show_fps:x,console_verbose:x,autoresize:!0})};var r={state:f.CM_WALK,lastStateWalk:f.CM_WALK,ladderState:!1,obj:0,set:function(a,c){a!=f.CM_WALK&&a!=f.CM_RUN||"ladder"==c||(this.lastStateWalk=a);"ladder"==c?a==f.CM_CLIMB?(f.set_character_move_type(this.obj,f.CM_CLIMB),this.ladderState=!0):(f.set_character_move_type(this.obj,this.lastStateWalk),
this.ladderState=!1):0==this.ladderState&&f.set_character_move_type(this.obj,a)}}});b4w.require("runner").init();
